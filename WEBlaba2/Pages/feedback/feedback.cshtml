@page
@model WEBlaba2.Pages.feedback.FeedbackModel
@{
}

<!DOCTYPE html>
<html>
<head>
    <title>Рив-Гош - Отзывы</title>
    <link href="~/styles/stylescss.css" rel="stylesheet" />
    <link href="~/styles/modal.css" rel="stylesheet" />
    <link href="~/styles/feedback.css" rel="stylesheet" />
    <script src="~/Scripts/Model.js" defer></script>
</head>
<body class="menuCatalog">
    <!-- Хедер оставляем как есть -->
    <div class="base header roundl">
        <div class="grid-container-head">
            <div class="grid-item-center"><img style="width:150px" src="~/images/logo.png"></div>
            <div class="grid-item-center"><h1>РИВ ГОШ</h1></div>
            <div class="grid-item-center" bgcolor="#ffbb34">
                
            </div>
        </div>
    </div>

    <div class="grid-container-main base ">
        <div class="grid-item sidebar-menu">
            <div class="menu-container">
                <nav class="navigation-menu">
                    <a asp-page="/Index" class="nav-link">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-text">Главная</span>
                    </a>
                    <a asp-page="/Catalog" class="nav-link">
                        <span class="nav-icon">📦</span>
                        <span class="nav-text">Каталог</span>
                    </a>
                    <a asp-page="/contacts" class="nav-link">
                        <span class="nav-icon">📞</span>
                        <span class="nav-text">Контакты</span>
                    </a>
                    <a asp-page="/feedback/feedback" class="nav-link active">
                        <span class="nav-icon">⭐</span>
                        <span class="nav-text">Отзывы</span>
                    </a>
                    <a asp-page="/aboutme" class="nav-link">
                        <span class="nav-icon">ℹ️</span>
                        <span class="nav-text">О нас</span>
                    </a>
                </nav>
            </div>
        </div>

        <div class="grid-item menu">
            <h2>Отзывы о нашем магазине</h2>

            <!-- Сообщение об успехе -->
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="success-message">
                    @TempData["SuccessMessage"]
                </div>
            }

            <!-- Форма добавления отзыва (только для авторизованных) -->
            @if (Model.IsAuthenticated)
            {
                <div class="feedback-form-container">
                    <h3>Оставьте ваш отзыв</h3>
                    <form class="feedback-form" method="post" asp-page-handler="AddFeedback">
                        @Html.AntiForgeryToken()
                        <div class="form-group full-width">
                            <label for="title">Заголовок отзыва *</label>
                            <input type="text" id="title" asp-for="FeedbackInput.Title" required
                                   placeholder="Кратко опишите ваш отзыв">
                        </div>

                      
                        <div class="form-group full-width">
                            <label for="rating">Ваша оценка *</label>
                            <select id="rating" asp-for="FeedbackInput.Rating" class="form-control" required>
                                <option value="">Выберите оценку</option>
                                <option value="5">⭐️⭐️⭐️⭐️⭐️ Отлично (5)</option>
                                <option value="4">⭐️⭐️⭐️⭐️ Хорошо (4)</option>
                                <option value="3">⭐️⭐️⭐️ Удовлетворительно (3)</option>
                                <option value="2">⭐️⭐️ Плохо (2)</option>
                                <option value="1">⭐️ Очень плохо (1)</option>
                            </select>
                        </div>

                       
                        <div class="form-group full-width">
                            <label for="category">Категория отзыва</label>
                            <select id="category" asp-for="FeedbackInput.Category">
                                <option value="">Выберите категорию</option>
                                <option value="service">Обслуживание</option>
                                <option value="quality">Качество товаров</option>
                                <option value="delivery">Доставка</option>
                                <option value="prices">Цены</option>
                                <option value="website">Работа сайта</option>
                            </select>
                        </div>

                        
                        <div class="form-group full-width">
                            <label for="message">Текст отзыва *</label>
                            <textarea id="message" asp-for="FeedbackInput.Message" rows="5" required
                                      placeholder="Подробно опишите ваши впечатления..."></textarea>
                        </div>

                        
                        <div class="form-group full-width">
                            <button type="submit" class="submit-btn">Опубликовать отзыв</button>
                        </div>
                    </form>
                </div>
            }
            else
            {
                <div class="auth-required">
                    <p>Чтобы оставить отзыв, пожалуйста, <a asp-page="/auth/Authorization">авторизуйтесь</a>.</p>
                </div>
            }

            <!-- Список всех отзывов -->
            <div class="feedbacks-container">
                <h3>Отзывы наших клиентов</h3>

                @if (Model.Feedbacks.Any())
                {
                    foreach (var feedback in Model.Feedbacks)
                    {
                        <div class="feedback-item">
                            <div class="feedback-header">
                                <div>
                                    <span class="feedback-author">@feedback.UserName</span>
                                    @if (!string.IsNullOrEmpty(feedback.Category))
                                    {
                                        <span class="feedback-category">@GetCategoryName(feedback.Category)</span>
                                    }
                                </div>
                                <div>
                                    <span class="feedback-date">@feedback.CreatedDate.ToString("dd.MM.yyyy HH:mm")</span>
                                    <span class="feedback-rating">
                                        @for (int i = 0; i < 5; i++)
                                        {
                                            if (i < feedback.Rating)
                                            {
                                                <span>⭐</span>
                                            }
                                            else
                                            {
                                                <span>☆</span>
                                            }
                                        }
                                    </span>
                                </div>
                            </div>
                            <div class="feedback-title">@feedback.Title</div>
                            <div class="feedback-message">
                                <p>@feedback.Message</p>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>Пока нет отзывов. Будьте первым!</p>
                }
            </div>
        </div>

    
        <div class="grid-item roundl">
            <div class="flex-container" style="flex-direction:column ; justify-content:space-evenly">
                <div class="flex-item-center">
                    <a href=https://www.dior.com />
                    <img class="baner" src="~/images/Dior_Logo.png">
                </div>
                <div class="flex-item-center">
                    <a href=https://www.versace.ru />
                    <img class="baner" src="~/images/Versace.jpg">
                </div>
                <div class="flex-item-center">
                    <a href=https://www.dove.com/us/en/home.html>
                        <img class="baner" src="~/images/dove.jpg">
                    </a>
                </div>
            </div>
        </div>
    </div>

    @await Html.PartialAsync("Model")
    <div class="base head roundl">
        <p class="HeaderText text" style="height:35px; margin:0; padding:5px;">
            <a href="#" style=" color: #000000; text-decoration: none; cursor: pointer; transition: color 0.3s ease;" class="agreement-link" data-document="oferta.pdf" data-title="Публичная оферта"> Оферта</a>,
            <a href="#" style=" color: #000000; text-decoration: none; cursor: pointer; transition: color 0.3s ease;" class="agreement-link" data-document="Политика обработки персональных данных.pdf" data-title="Политика обработки персональных данных"> Политика обработки персональных данных</a>,
            <a href="#" style=" color: #000000; text-decoration: none; cursor: pointer; transition: color 0.3s ease;" class="agreement-link" data-document="правила продажи.pdf" data-title=" Правила продажи">Правила продажи</a>
        </p>
        <p class="HeaderText text" style="height:35px; margin:0; padding:5px">© 2025 РИВ ГОШ. Все права защищены.</p>
        <p class="HeaderText text" style="height:35px; margin:0; padding:5px">Телефон: 8 (800) 2344460 | shopadmin@rivegauche.ru</p>
    </div>

</body>
</html>

@functions {
    public string GetCategoryName(string category)
    {
        return category switch
        {
            "service" => "Обслуживание",
            "quality" => "Качество товаров",
            "delivery" => "Доставка",
            "prices" => "Цены",
            "website" => "Работа сайта",
            _ => category
        };
    }
}